{"version":3,"file":"useLicenseLimitNotification-g1vq6nzk.js","sources":["../../ee/admin/src/hooks/useLicenseLimitNotification.ts"],"sourcesContent":["/**\n *\n * useLicenseLimitNotification\n *\n */\nimport * as React from 'react';\n\nimport isNil from 'lodash/isNil';\nimport { useIntl } from 'react-intl';\nimport { useLocation } from 'react-router-dom';\n\nimport { NotificationConfig, useNotification } from '../../../../admin/src/features/Notifications';\n\nimport { useLicenseLimits } from './useLicenseLimits';\n\nconst STORAGE_KEY_PREFIX = 'strapi-notification-seat-limit';\n\nconst BILLING_STRAPI_CLOUD_URL = 'https://cloud.strapi.io/profile/billing';\nconst BILLING_SELF_HOSTED_URL = 'https://strapi.io/billing/request-seats';\n\nexport const useLicenseLimitNotification = () => {\n  const { formatMessage } = useIntl();\n  const { license, isError, isLoading } = useLicenseLimits();\n  const { toggleNotification } = useNotification();\n  const { pathname } = useLocation();\n\n  const { enforcementUserCount, permittedSeats, licenseLimitStatus, isHostedOnStrapiCloud } =\n    license ?? {};\n\n  React.useEffect(() => {\n    if (isError || isLoading) {\n      return;\n    }\n\n    const shouldDisplayNotification =\n      !isNil(permittedSeats) &&\n      !window.sessionStorage.getItem(`${STORAGE_KEY_PREFIX}-${pathname}`) &&\n      (licenseLimitStatus === 'AT_LIMIT' || licenseLimitStatus === 'OVER_LIMIT');\n\n    let notificationType: NotificationConfig['type'];\n\n    if (licenseLimitStatus === 'OVER_LIMIT') {\n      notificationType = 'danger';\n    } else if (licenseLimitStatus === 'AT_LIMIT') {\n      notificationType = 'warning';\n    }\n\n    if (shouldDisplayNotification) {\n      toggleNotification({\n        type: notificationType,\n        message: formatMessage(\n          {\n            id: 'notification.ee.warning.over-.message',\n            defaultMessage:\n              \"Add seats to {licenseLimitStatus, select, OVER_LIMIT {invite} other {re-enable}} Users. If you already did it but it's not reflected in Strapi yet, make sure to restart your app.\",\n          },\n          { licenseLimitStatus }\n        ),\n        title: formatMessage(\n          {\n            id: 'notification.ee.warning.at-seat-limit.title',\n            defaultMessage:\n              '{licenseLimitStatus, select, OVER_LIMIT {Over} other {At}} seat limit ({enforcementUserCount}/{permittedSeats})',\n          },\n          {\n            licenseLimitStatus,\n            enforcementUserCount,\n            permittedSeats,\n          }\n        ),\n        link: {\n          url: isHostedOnStrapiCloud ? BILLING_STRAPI_CLOUD_URL : BILLING_SELF_HOSTED_URL,\n          label: formatMessage(\n            {\n              id: 'notification.ee.warning.seat-limit.link',\n              defaultMessage:\n                '{isHostedOnStrapiCloud, select, true {ADD SEATS} other {CONTACT SALES}}',\n            },\n            { isHostedOnStrapiCloud }\n          ),\n        },\n        blockTransition: true,\n        onClose() {\n          window.sessionStorage.setItem(`${STORAGE_KEY_PREFIX}-${pathname}`, 'true');\n        },\n      });\n    }\n  }, [\n    toggleNotification,\n    license,\n    pathname,\n    formatMessage,\n    isLoading,\n    permittedSeats,\n    licenseLimitStatus,\n    enforcementUserCount,\n    isHostedOnStrapiCloud,\n    isError,\n  ]);\n};\n"],"names":["useIntl","useLicenseLimits","useNotification","useLocation","React","isNil"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAeA,MAAM,kBAAqB,GAAA,gCAAA,CAAA;AAE3B,MAAM,wBAA2B,GAAA,yCAAA,CAAA;AACjC,MAAM,uBAA0B,GAAA,yCAAA,CAAA;AAEzB,MAAM,8BAA8B,MAAM;AAC/C,EAAM,MAAA,EAAE,aAAc,EAAA,GAAIA,iBAAQ,EAAA,CAAA;AAClC,EAAA,MAAM,EAAE,OAAA,EAAS,OAAS,EAAA,SAAA,KAAcC,iCAAiB,EAAA,CAAA;AACzD,EAAM,MAAA,EAAE,kBAAmB,EAAA,GAAIC,qBAAgB,EAAA,CAAA;AAC/C,EAAM,MAAA,EAAE,QAAS,EAAA,GAAIC,0BAAY,EAAA,CAAA;AAEjC,EAAA,MAAM,EAAE,oBAAsB,EAAA,cAAA,EAAgB,oBAAoB,qBAAsB,EAAA,GACtF,WAAW,EAAC,CAAA;AAEd,EAAAC,gBAAA,CAAM,UAAU,MAAM;AACpB,IAAA,IAAI,WAAW,SAAW,EAAA;AACxB,MAAA,OAAA;AAAA,KACF;AAEA,IAAA,MAAM,4BACJ,CAACC,sBAAA,CAAM,cAAc,CAAA,IACrB,CAAC,MAAO,CAAA,cAAA,CAAe,OAAQ,CAAA,CAAA,EAAG,kBAAkB,CAAI,CAAA,EAAA,QAAQ,EAAE,CACjE,KAAA,kBAAA,KAAuB,cAAc,kBAAuB,KAAA,YAAA,CAAA,CAAA;AAE/D,IAAI,IAAA,gBAAA,CAAA;AAEJ,IAAA,IAAI,uBAAuB,YAAc,EAAA;AACvC,MAAmB,gBAAA,GAAA,QAAA,CAAA;AAAA,KACrB,MAAA,IAAW,uBAAuB,UAAY,EAAA;AAC5C,MAAmB,gBAAA,GAAA,SAAA,CAAA;AAAA,KACrB;AAEA,IAAA,IAAI,yBAA2B,EAAA;AAC7B,MAAmB,kBAAA,CAAA;AAAA,QACjB,IAAM,EAAA,gBAAA;AAAA,QACN,OAAS,EAAA,aAAA;AAAA,UACP;AAAA,YACE,EAAI,EAAA,uCAAA;AAAA,YACJ,cACE,EAAA,oLAAA;AAAA,WACJ;AAAA,UACA,EAAE,kBAAmB,EAAA;AAAA,SACvB;AAAA,QACA,KAAO,EAAA,aAAA;AAAA,UACL;AAAA,YACE,EAAI,EAAA,6CAAA;AAAA,YACJ,cACE,EAAA,iHAAA;AAAA,WACJ;AAAA,UACA;AAAA,YACE,kBAAA;AAAA,YACA,oBAAA;AAAA,YACA,cAAA;AAAA,WACF;AAAA,SACF;AAAA,QACA,IAAM,EAAA;AAAA,UACJ,GAAA,EAAK,wBAAwB,wBAA2B,GAAA,uBAAA;AAAA,UACxD,KAAO,EAAA,aAAA;AAAA,YACL;AAAA,cACE,EAAI,EAAA,yCAAA;AAAA,cACJ,cACE,EAAA,yEAAA;AAAA,aACJ;AAAA,YACA,EAAE,qBAAsB,EAAA;AAAA,WAC1B;AAAA,SACF;AAAA,QACA,eAAiB,EAAA,IAAA;AAAA,QACjB,OAAU,GAAA;AACR,UAAA,MAAA,CAAO,eAAe,OAAQ,CAAA,CAAA,EAAG,kBAAkB,CAAI,CAAA,EAAA,QAAQ,IAAI,MAAM,CAAA,CAAA;AAAA,SAC3E;AAAA,OACD,CAAA,CAAA;AAAA,KACH;AAAA,GACC,EAAA;AAAA,IACD,kBAAA;AAAA,IACA,OAAA;AAAA,IACA,QAAA;AAAA,IACA,aAAA;AAAA,IACA,SAAA;AAAA,IACA,cAAA;AAAA,IACA,kBAAA;AAAA,IACA,oBAAA;AAAA,IACA,qBAAA;AAAA,IACA,OAAA;AAAA,GACD,CAAA,CAAA;AACH;;;;"}