import {
  buildValidParams,
  useDocument,
  useDocumentActions
} from "./chunk-MANLSTJ4.js";
import {
  Table,
  create3 as create,
  create6 as create2,
  require_omit,
  useForm,
  useQueryParams,
  useTable
} from "./chunk-BRGDJEWV.js";
import {
  useAPIErrorHandler,
  useAuth,
  useNotification
} from "./chunk-H4TCRMJP.js";
import {
  Box,
  Button,
  CheckboxImpl,
  Dialog,
  Field,
  Flex,
  IconButton,
  Modal,
  Popover,
  SingleSelect,
  SingleSelectOption,
  Status,
  TooltipImpl,
  Typography,
  VisuallyHidden,
  adminApi,
  require_get,
  require_lib,
  skipToken,
  useCollator,
  useIntl
} from "./chunk-OV6QPJDJ.js";
import {
  Link,
  matchPath,
  useNavigate,
  useParams
} from "./chunk-ZCKYMJUG.js";
import {
  ForwardRef$1r,
  ForwardRef$2h,
  ForwardRef$3,
  ForwardRef$3B,
  ForwardRef$3D,
  ForwardRef$3J,
  ForwardRef$3T,
  ForwardRef$3V,
  ForwardRef$4D,
  ForwardRef$4T,
  ForwardRef$4n,
  ForwardRef$j
} from "./chunk-DICHSZ7M.js";
import {
  require_jsx_runtime
} from "./chunk-QBLEIVF7.js";
import {
  dt
} from "./chunk-6VAEU2GM.js";
import {
  require_react
} from "./chunk-BCGHH3YY.js";
import {
  __toESM
} from "./chunk-WGAPYIUP.js";

// node_modules/@strapi/i18n/dist/_chunks/index-D-qx3tz4.mjs
var import_get = __toESM(require_get(), 1);
var import_jsx_runtime = __toESM(require_jsx_runtime(), 1);
var React = __toESM(require_react(), 1);
var qs = __toESM(require_lib(), 1);
var import_qs = __toESM(require_lib(), 1);
var import_omit = __toESM(require_omit(), 1);
var __variableDynamicImportRuntimeHelper = (glob, path) => {
  const v = glob[path];
  if (v) {
    return typeof v === "function" ? v() : Promise.resolve(v);
  }
  return new Promise((_, reject) => {
    (typeof queueMicrotask === "function" ? queueMicrotask : setTimeout)(reject.bind(null, new Error("Unknown variable dynamic import: " + path)));
  });
};
var pluginId = "i18n";
var getTranslation = (id) => `${pluginId}.${id}`;
var TextAlignTypography = dt(Typography)`
  text-align: center;
`;
var CheckboxConfirmation = ({
  description,
  isCreating = false,
  intlLabel,
  name,
  onChange,
  value
}) => {
  const { formatMessage } = useIntl();
  const [isOpen, setIsOpen] = React.useState(false);
  const handleChange = (value2) => {
    if (isCreating || value2) {
      return onChange({ target: { name, value: value2, type: "checkbox" } });
    }
    if (!value2) {
      return setIsOpen(true);
    }
    return null;
  };
  const handleConfirm = () => {
    onChange({ target: { name, value: false, type: "checkbox" } });
  };
  const label = intlLabel.id ? formatMessage(
    { id: intlLabel.id, defaultMessage: intlLabel.defaultMessage },
    { ...intlLabel.values }
  ) : name;
  const hint = description ? formatMessage(
    { id: description.id, defaultMessage: description.defaultMessage },
    { ...description.values }
  ) : "";
  return (0, import_jsx_runtime.jsxs)(Dialog.Root, { open: isOpen, onOpenChange: setIsOpen, children: [
    (0, import_jsx_runtime.jsxs)(Field.Root, { hint, name, children: [
      (0, import_jsx_runtime.jsx)(CheckboxImpl, { onCheckedChange: handleChange, checked: value, children: label }),
      (0, import_jsx_runtime.jsx)(Field.Hint, {})
    ] }),
    (0, import_jsx_runtime.jsxs)(Dialog.Content, { children: [
      (0, import_jsx_runtime.jsx)(Dialog.Header, { children: formatMessage({
        id: getTranslation("CheckboxConfirmation.Modal.title"),
        defaultMessage: "Disable localization"
      }) }),
      (0, import_jsx_runtime.jsx)(Dialog.Body, { icon: (0, import_jsx_runtime.jsx)(ForwardRef$3, {}), children: (0, import_jsx_runtime.jsxs)(Flex, { direction: "column", alignItems: "stretch", gap: 2, children: [
        (0, import_jsx_runtime.jsx)(Flex, { justifyContent: "center", children: (0, import_jsx_runtime.jsx)(TextAlignTypography, { children: formatMessage({
          id: getTranslation("CheckboxConfirmation.Modal.content"),
          defaultMessage: "Disabling localization will engender the deletion of all your content but the one associated to your default locale (if existing)."
        }) }) }),
        (0, import_jsx_runtime.jsx)(Flex, { justifyContent: "center", children: (0, import_jsx_runtime.jsx)(Typography, { fontWeight: "semiBold", children: formatMessage({
          id: getTranslation("CheckboxConfirmation.Modal.body"),
          defaultMessage: "Do you want to disable it?"
        }) }) })
      ] }) }),
      (0, import_jsx_runtime.jsxs)(Dialog.Footer, { children: [
        (0, import_jsx_runtime.jsx)(Dialog.Cancel, { children: (0, import_jsx_runtime.jsx)(Button, { variant: "tertiary", children: formatMessage({
          id: "components.popUpWarning.button.cancel",
          defaultMessage: "No, cancel"
        }) }) }),
        (0, import_jsx_runtime.jsx)(Dialog.Action, { children: (0, import_jsx_runtime.jsx)(Button, { variant: "danger-light", onClick: handleConfirm, children: formatMessage({
          id: getTranslation("CheckboxConfirmation.Modal.button-confirm"),
          defaultMessage: "Yes, disable"
        }) }) })
      ] })
    ] })
  ] });
};
var LOCALIZED_FIELDS = [
  "biginteger",
  "boolean",
  "component",
  "date",
  "datetime",
  "decimal",
  "dynamiczone",
  "email",
  "enumeration",
  "float",
  "integer",
  "json",
  "media",
  "number",
  "password",
  "richtext",
  "blocks",
  "string",
  "text",
  "time"
];
var doesPluginOptionsHaveI18nLocalized = (opts) => typeof opts === "object" && opts !== null && "i18n" in opts && typeof opts.i18n === "object" && opts.i18n !== null && "localized" in opts.i18n && typeof opts.i18n.localized === "boolean";
var capitalize = (str) => str.charAt(0).toUpperCase() + str.slice(1);
var useI18n = () => {
  const params = useParams();
  const userPermissions = useAuth("useI18n", (state) => state.permissions);
  const actions = React.useMemo(() => {
    const permissions = userPermissions.filter((permission) => permission.subject === params.slug);
    return permissions.reduce(
      (acc, permission) => {
        var _a;
        const [actionShorthand] = permission.action.split(".").slice(-1);
        return {
          ...acc,
          [`can${capitalize(actionShorthand)}`]: ((_a = permission.properties) == null ? void 0 : _a.locales) ?? []
        };
      },
      { canCreate: [], canRead: [], canUpdate: [], canDelete: [], canPublish: [] }
    );
  }, [params.slug, userPermissions]);
  const { schema } = useDocument(
    {
      // We can non-null assert these because below we skip the query if they are not present
      collectionType: params.collectionType,
      model: params.slug
    },
    {
      skip: true
    }
  );
  if (doesPluginOptionsHaveI18nLocalized(schema == null ? void 0 : schema.pluginOptions)) {
    return {
      hasI18n: schema.pluginOptions.i18n.localized,
      ...actions
    };
  }
  return {
    hasI18n: false,
    ...actions
  };
};
var i18nApi = adminApi.enhanceEndpoints({
  addTagTypes: ["Locale"]
});
var localesApi = i18nApi.injectEndpoints({
  endpoints: (builder) => ({
    createLocale: builder.mutation({
      query: (data) => ({
        url: "/i18n/locales",
        method: "POST",
        data
      }),
      invalidatesTags: [{ type: "Locale", id: "LIST" }]
    }),
    deleteLocale: builder.mutation({
      query: (id) => ({
        url: `/i18n/locales/${id}`,
        method: "DELETE"
      }),
      invalidatesTags: (result, error, id) => [{ type: "Locale", id }]
    }),
    getLocales: builder.query({
      query: () => "/i18n/locales",
      providesTags: (res) => [
        { type: "Locale", id: "LIST" },
        ...Array.isArray(res) ? res.map((locale) => ({
          type: "Locale",
          id: locale.id
        })) : []
      ]
    }),
    getDefaultLocales: builder.query({
      query: () => "/i18n/iso-locales"
    }),
    updateLocale: builder.mutation({
      query: ({ id, ...data }) => ({
        url: `/i18n/locales/${id}`,
        method: "PUT",
        data
      }),
      invalidatesTags: (result, error, { id }) => [{ type: "Locale", id }]
    })
  })
});
var {
  useCreateLocaleMutation,
  useDeleteLocaleMutation,
  useGetLocalesQuery,
  useGetDefaultLocalesQuery,
  useUpdateLocaleMutation
} = localesApi;
var relationsApi = i18nApi.injectEndpoints({
  overrideExisting: true,
  endpoints: (builder) => ({
    getManyDraftRelationCount: builder.query({
      query: ({ model, ...params }) => ({
        url: `/content-manager/collection-types/${model}/actions/countManyEntriesDraftRelations`,
        method: "GET",
        config: {
          params
        }
      }),
      transformResponse: (response) => response.data
    })
  })
});
var { useGetManyDraftRelationCountQuery } = relationsApi;
var cleanData = (data, schema, components) => {
  const cleanedData = removeFields(data, [
    "createdAt",
    "createdBy",
    "updatedAt",
    "updatedBy",
    "id",
    "documentId",
    "publishedAt",
    "strapi_stage",
    "strapi_assignee",
    "locale"
  ]);
  const cleanedDataWithoutPasswordAndRelation = recursiveRemoveFieldTypes(
    cleanedData,
    schema,
    components,
    ["relation", "password"]
  );
  return cleanedDataWithoutPasswordAndRelation;
};
var removeFields = (data, fields) => {
  return Object.keys(data).reduce((acc, current) => {
    if (fields.includes(current)) {
      return acc;
    }
    acc[current] = data[current];
    return acc;
  }, {});
};
var recursiveRemoveFieldTypes = (data, schema, components, fields) => {
  return Object.keys(data).reduce((acc, current) => {
    const attribute = schema.attributes[current] ?? { type: void 0 };
    if (fields.includes(attribute.type)) {
      return acc;
    }
    if (attribute.type === "dynamiczone") {
      acc[current] = data[current].map((componentValue, index2) => {
        const { id: _, ...rest } = recursiveRemoveFieldTypes(
          componentValue,
          components[componentValue.__component],
          components,
          fields
        );
        return {
          ...rest,
          __temp_key__: index2 + 1
        };
      });
    } else if (attribute.type === "component") {
      const { repeatable, component } = attribute;
      if (repeatable) {
        acc[current] = (data[current] ?? []).map((compoData, index2) => {
          const { id: _, ...rest } = recursiveRemoveFieldTypes(
            compoData,
            components[component],
            components,
            fields
          );
          return {
            ...rest,
            __temp_key__: index2 + 1
          };
        });
      } else {
        const { id: _, ...rest } = recursiveRemoveFieldTypes(
          data[current] ?? {},
          components[component],
          components,
          fields
        );
        acc[current] = rest;
      }
    } else {
      acc[current] = data[current];
    }
    return acc;
  }, {});
};
var isErrorMessageDescriptor = (object) => {
  return typeof object === "object" && object !== null && "id" in object && "defaultMessage" in object;
};
var EntryValidationText = ({
  status = "draft",
  validationErrors,
  action
}) => {
  const { formatMessage } = useIntl();
  const getErrorStr = (key, value) => {
    if (typeof value === "string") {
      return `${key}: ${value}`;
    } else if (isErrorMessageDescriptor(value)) {
      return `${key}: ${formatMessage(value)}`;
    } else if (Array.isArray(value)) {
      return value.map((v) => getErrorStr(key, v)).join(" ");
    } else if (typeof value === "object" && !Array.isArray(value)) {
      return Object.entries(value).map(([k, v]) => getErrorStr(k, v)).join(" ");
    } else {
      return "";
    }
  };
  if (validationErrors) {
    const validationErrorsMessages = Object.entries(validationErrors).map(([key, value]) => {
      return getErrorStr(key, value);
    }).join(" ");
    return (0, import_jsx_runtime.jsxs)(Flex, { gap: 2, children: [
      (0, import_jsx_runtime.jsx)(ForwardRef$3T, { fill: "danger600" }),
      (0, import_jsx_runtime.jsx)(TooltipImpl, { label: validationErrorsMessages, children: (0, import_jsx_runtime.jsx)(
        Typography,
        {
          maxWidth: "30rem",
          textColor: "danger600",
          variant: "omega",
          fontWeight: "semiBold",
          ellipsis: true,
          children: validationErrorsMessages
        }
      ) })
    ] });
  }
  const getStatusMessage = () => {
    if (action === "bulk-publish") {
      if (status === "published") {
        return {
          icon: (0, import_jsx_runtime.jsx)(ForwardRef$4n, { fill: "success600" }),
          text: formatMessage({
            id: "content-manager.bulk-publish.already-published",
            defaultMessage: "Already Published"
          }),
          textColor: "success600",
          fontWeight: "bold"
        };
      } else if (status === "modified") {
        return {
          icon: (0, import_jsx_runtime.jsx)(ForwardRef$4T, { fill: "alternative600" }),
          text: formatMessage({
            id: "app.utils.ready-to-publish-changes",
            defaultMessage: "Ready to publish changes"
          })
        };
      } else {
        return {
          icon: (0, import_jsx_runtime.jsx)(ForwardRef$4n, { fill: "success600" }),
          text: formatMessage({
            id: "app.utils.ready-to-publish",
            defaultMessage: "Ready to publish"
          })
        };
      }
    } else {
      if (status === "draft") {
        return {
          icon: (0, import_jsx_runtime.jsx)(ForwardRef$4n, { fill: "success600" }),
          text: formatMessage({
            id: "content-manager.bulk-unpublish.already-unpublished",
            defaultMessage: "Already Unpublished"
          }),
          textColor: "success600",
          fontWeight: "bold"
        };
      } else {
        return {
          icon: (0, import_jsx_runtime.jsx)(ForwardRef$4n, { fill: "success600" }),
          text: formatMessage({
            id: "app.utils.ready-to-unpublish-changes",
            defaultMessage: "Ready to unpublish"
          }),
          textColor: "success600",
          fontWeight: "bold"
        };
      }
    }
  };
  const { icon, text, textColor = "success600", fontWeight = "normal" } = getStatusMessage();
  return (0, import_jsx_runtime.jsxs)(Flex, { gap: 2, children: [
    icon,
    (0, import_jsx_runtime.jsx)(Typography, { textColor, fontWeight, children: text })
  ] });
};
var BoldChunk = (chunks) => (0, import_jsx_runtime.jsx)(Typography, { fontWeight: "bold", children: chunks });
var BulkLocaleActionModal = ({
  headers,
  rows,
  localesMetadata,
  validationErrors = {},
  action
}) => {
  const { formatMessage } = useIntl();
  const selectedRows = useTable(
    "BulkLocaleActionModal",
    (state) => state.selectedRows
  );
  const getFormattedCountMessage = () => {
    const currentStatusByLocale = rows.reduce((acc, { locale, status }) => {
      acc[locale] = status;
      return acc;
    }, {});
    const localesWithErrors = Object.keys(validationErrors);
    const publishedCount = selectedRows.filter(
      ({ locale }) => currentStatusByLocale[locale] === "published"
    ).length;
    const draftCount = selectedRows.filter(
      ({ locale }) => (currentStatusByLocale[locale] === "draft" || currentStatusByLocale[locale] === "modified") && !localesWithErrors.includes(locale)
    ).length;
    const withErrorsCount = localesWithErrors.length;
    const messageId = action === "bulk-publish" ? "content-manager.containers.list.selectedEntriesModal.selectedCount.publish" : "content-manager.containers.list.selectedEntriesModal.selectedCount.unpublish";
    const defaultMessage = action === "bulk-publish" ? "<b>{publishedCount}</b> {publishedCount, plural, =0 {entries} one {entry} other {entries}} already published. <b>{draftCount}</b> {draftCount, plural, =0 {entries} one {entry} other {entries}} ready to publish. <b>{withErrorsCount}</b> {withErrorsCount, plural, =0 {entries} one {entry} other {entries}} waiting for action." : "<b>{draftCount}</b> {draftCount, plural, =0 {entries} one {entry} other {entries}} already unpublished. <b>{publishedCount}</b> {publishedCount, plural, =0 {entries} one {entry} other {entries}} ready to unpublish.";
    return formatMessage(
      {
        id: messageId,
        defaultMessage
      },
      {
        withErrorsCount,
        draftCount,
        publishedCount,
        b: BoldChunk
      }
    );
  };
  return (0, import_jsx_runtime.jsxs)(Modal.Body, { children: [
    (0, import_jsx_runtime.jsx)(Typography, { children: getFormattedCountMessage() }),
    (0, import_jsx_runtime.jsx)(Box, { marginTop: 5, children: (0, import_jsx_runtime.jsxs)(Table.Content, { children: [
      (0, import_jsx_runtime.jsxs)(Table.Head, { children: [
        (0, import_jsx_runtime.jsx)(Table.HeaderCheckboxCell, {}),
        headers.map((head) => (0, import_jsx_runtime.jsx)(Table.HeaderCell, { ...head }, head.name))
      ] }),
      (0, import_jsx_runtime.jsx)(Table.Body, { children: rows.map(({ locale, status }, index2) => {
        var _a;
        const error = (validationErrors == null ? void 0 : validationErrors[locale]) ?? null;
        const statusVariant = status === "draft" ? "primary" : status === "published" ? "success" : "alternative";
        return (0, import_jsx_runtime.jsxs)(Table.Row, { children: [
          (0, import_jsx_runtime.jsx)(Table.CheckboxCell, { id: locale, "aria-label": `Select ${locale}` }),
          (0, import_jsx_runtime.jsx)(Table.Cell, { children: (0, import_jsx_runtime.jsx)(Typography, { variant: "sigma", textColor: "neutral600", children: Array.isArray(localesMetadata) ? (_a = localesMetadata.find((localeEntry) => localeEntry.code === locale)) == null ? void 0 : _a.name : locale }) }),
          (0, import_jsx_runtime.jsx)(Table.Cell, { children: (0, import_jsx_runtime.jsx)(Box, { display: "flex", children: (0, import_jsx_runtime.jsx)(
            Status,
            {
              display: "flex",
              paddingLeft: "6px",
              paddingRight: "6px",
              paddingTop: "2px",
              paddingBottom: "2px",
              showBullet: false,
              size: "S",
              variant: statusVariant,
              children: (0, import_jsx_runtime.jsx)(Typography, { tag: "span", variant: "pi", fontWeight: "bold", children: capitalize(status) })
            }
          ) }) }),
          (0, import_jsx_runtime.jsx)(Table.Cell, { children: (0, import_jsx_runtime.jsx)(EntryValidationText, { validationErrors: error, status, action }) }),
          (0, import_jsx_runtime.jsx)(Table.Cell, { children: (0, import_jsx_runtime.jsx)(
            IconButton,
            {
              tag: Link,
              to: {
                search: (0, import_qs.stringify)({ plugins: { i18n: { locale } } })
              },
              label: formatMessage(
                {
                  id: getTranslation("Settings.list.actions.edit"),
                  defaultMessage: "Edit {name} locale"
                },
                {
                  name: locale
                }
              ),
              variant: "ghost",
              children: (0, import_jsx_runtime.jsx)(ForwardRef$1r, {})
            }
          ) })
        ] }, index2);
      }) })
    ] }) })
  ] });
};
var LocalePickerAction = ({
  document,
  meta,
  model,
  collectionType,
  documentId
}) => {
  var _a, _b, _c;
  const { formatMessage } = useIntl();
  const [{ query }, setQuery] = useQueryParams();
  const { hasI18n, canCreate, canRead } = useI18n();
  const { data: locales = [] } = useGetLocalesQuery();
  const currentDesiredLocale = (_b = (_a = query.plugins) == null ? void 0 : _a.i18n) == null ? void 0 : _b.locale;
  const { schema } = useDocument({
    model,
    collectionType,
    documentId,
    params: { locale: currentDesiredLocale }
  });
  const handleSelect = React.useCallback(
    (value) => {
      setQuery({
        plugins: {
          ...query.plugins,
          i18n: {
            locale: value
          }
        }
      });
    },
    [query.plugins, setQuery]
  );
  React.useEffect(() => {
    if (!Array.isArray(locales) || !hasI18n) {
      return;
    }
    const doesLocaleExist = locales.find((loc) => loc.code === currentDesiredLocale);
    const defaultLocale = locales.find((locale) => locale.isDefault);
    if (!doesLocaleExist && (defaultLocale == null ? void 0 : defaultLocale.code)) {
      handleSelect(defaultLocale.code);
    }
  }, [handleSelect, hasI18n, locales, currentDesiredLocale]);
  const currentLocale = Array.isArray(locales) ? (_c = locales.find((locale) => locale.code === currentDesiredLocale)) == null ? void 0 : _c.code : void 0;
  const allCurrentLocales = [
    { status: getDocumentStatus(document, meta), locale: currentLocale },
    ...(meta == null ? void 0 : meta.availableLocales) ?? []
  ];
  if (!hasI18n || !Array.isArray(locales) || locales.length === 0) {
    return null;
  }
  return {
    label: formatMessage({
      id: getTranslation("Settings.locales.modal.locales.label"),
      defaultMessage: "Locales"
    }),
    options: locales.map((locale) => {
      var _a2;
      const currentLocaleDoc = allCurrentLocales.find(
        (doc) => "locale" in doc ? doc.locale === locale.code : false
      );
      const status = (currentLocaleDoc == null ? void 0 : currentLocaleDoc.status) ?? "draft";
      const permissionsToCheck = currentLocaleDoc ? canCreate : canRead;
      const statusVariant = status === "draft" ? "secondary" : status === "published" ? "success" : "alternative";
      return {
        disabled: !permissionsToCheck.includes(locale.code),
        value: locale.code,
        label: locale.name,
        startIcon: ((_a2 = schema == null ? void 0 : schema.options) == null ? void 0 : _a2.draftAndPublish) ? (0, import_jsx_runtime.jsx)(
          Status,
          {
            display: "flex",
            paddingLeft: "6px",
            paddingRight: "6px",
            paddingTop: "2px",
            paddingBottom: "2px",
            showBullet: false,
            size: "S",
            variant: statusVariant,
            children: (0, import_jsx_runtime.jsx)(Typography, { tag: "span", variant: "pi", fontWeight: "bold", children: capitalize(status) })
          }
        ) : null
      };
    }),
    onSelect: handleSelect,
    value: currentLocale
  };
};
var getDocumentStatus = (document, meta) => {
  const docStatus = document == null ? void 0 : document.status;
  const statuses = (meta == null ? void 0 : meta.availableStatus) ?? [];
  if (!docStatus) {
    return "draft";
  }
  if (docStatus === "draft" && statuses.find((doc) => doc.publishedAt !== null)) {
    return "published";
  }
  return docStatus;
};
var FillFromAnotherLocaleAction = ({
  documentId,
  meta,
  model,
  collectionType
}) => {
  var _a, _b;
  const { formatMessage } = useIntl();
  const [{ query }] = useQueryParams();
  const currentDesiredLocale = (_b = (_a = query.plugins) == null ? void 0 : _a.i18n) == null ? void 0 : _b.locale;
  const [localeSelected, setLocaleSelected] = React.useState(null);
  const setValues = useForm("FillFromAnotherLocale", (state) => state.setValues);
  const { getDocument } = useDocumentActions();
  const { schema, components } = useDocument({
    model,
    documentId,
    collectionType,
    params: { locale: currentDesiredLocale }
  });
  const { data: locales = [] } = useGetLocalesQuery();
  const availableLocales = Array.isArray(locales) ? locales.filter((locale) => meta == null ? void 0 : meta.availableLocales.some((l) => l.locale === locale.code)) : [];
  const fillFromLocale = (onClose) => async () => {
    const response = await getDocument({
      collectionType,
      model,
      documentId,
      params: { locale: localeSelected }
    });
    if (!response || !schema) {
      return;
    }
    const { data } = response;
    const cleanedData = cleanData(data, schema, components);
    setValues(cleanedData);
    onClose();
  };
  return {
    type: "icon",
    icon: (0, import_jsx_runtime.jsx)(ForwardRef$3J, {}),
    disabled: availableLocales.length === 0,
    label: formatMessage({
      id: getTranslation("CMEditViewCopyLocale.copy-text"),
      defaultMessage: "Fill in from another locale"
    }),
    dialog: {
      type: "dialog",
      title: formatMessage({
        id: getTranslation("CMEditViewCopyLocale.dialog.title"),
        defaultMessage: "Confirmation"
      }),
      content: ({ onClose }) => (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
        (0, import_jsx_runtime.jsx)(Dialog.Body, { children: (0, import_jsx_runtime.jsxs)(Flex, { direction: "column", gap: 3, children: [
          (0, import_jsx_runtime.jsx)(ForwardRef$3, { width: "24px", height: "24px", fill: "danger600" }),
          (0, import_jsx_runtime.jsx)(Typography, { textAlign: "center", children: formatMessage({
            id: getTranslation("CMEditViewCopyLocale.dialog.body"),
            defaultMessage: "Your current content will be erased and filled by the content of the selected locale:"
          }) }),
          (0, import_jsx_runtime.jsxs)(Field.Root, { width: "100%", children: [
            (0, import_jsx_runtime.jsx)(Field.Label, { children: formatMessage({
              id: getTranslation("CMEditViewCopyLocale.dialog.field.label"),
              defaultMessage: "Locale"
            }) }),
            (0, import_jsx_runtime.jsx)(
              SingleSelect,
              {
                value: localeSelected,
                placeholder: formatMessage({
                  id: getTranslation("CMEditViewCopyLocale.dialog.field.placeholder"),
                  defaultMessage: "Select one locale..."
                }),
                onChange: (value) => setLocaleSelected(value),
                children: availableLocales.map((locale) => (0, import_jsx_runtime.jsx)(SingleSelectOption, { value: locale.code, children: locale.name }, locale.code))
              }
            )
          ] })
        ] }) }),
        (0, import_jsx_runtime.jsx)(Dialog.Footer, { children: (0, import_jsx_runtime.jsxs)(Flex, { gap: 2, width: "100%", children: [
          (0, import_jsx_runtime.jsx)(Button, { flex: "auto", variant: "tertiary", onClick: onClose, children: formatMessage({
            id: getTranslation("CMEditViewCopyLocale.cancel-text"),
            defaultMessage: "No, cancel"
          }) }),
          (0, import_jsx_runtime.jsx)(Button, { flex: "auto", variant: "success", onClick: fillFromLocale(onClose), children: formatMessage({
            id: getTranslation("CMEditViewCopyLocale.submit-text"),
            defaultMessage: "Yes, fill in"
          }) })
        ] }) })
      ] })
    }
  };
};
var DeleteLocaleAction = ({
  document,
  documentId,
  model,
  collectionType
}) => {
  const { formatMessage } = useIntl();
  const navigate = useNavigate();
  const { toggleNotification } = useNotification();
  const { delete: deleteAction } = useDocumentActions();
  const { hasI18n, canDelete } = useI18n();
  if (!hasI18n) {
    return null;
  }
  return {
    disabled: (document == null ? void 0 : document.locale) && !canDelete.includes(document.locale) || !document || !document.id,
    position: ["header", "table-row"],
    label: formatMessage({
      id: getTranslation("actions.delete.label"),
      defaultMessage: "Delete locale"
    }),
    icon: (0, import_jsx_runtime.jsx)(StyledTrash, {}),
    variant: "danger",
    dialog: {
      type: "dialog",
      title: formatMessage({
        id: getTranslation("actions.delete.dialog.title"),
        defaultMessage: "Confirmation"
      }),
      content: (0, import_jsx_runtime.jsxs)(Flex, { direction: "column", gap: 2, children: [
        (0, import_jsx_runtime.jsx)(ForwardRef$3, { width: "24px", height: "24px", fill: "danger600" }),
        (0, import_jsx_runtime.jsx)(Typography, { tag: "p", variant: "omega", textAlign: "center", children: formatMessage({
          id: getTranslation("actions.delete.dialog.body"),
          defaultMessage: "Are you sure?"
        }) })
      ] }),
      onConfirm: async () => {
        if (!documentId || !(document == null ? void 0 : document.locale)) {
          console.error(
            "You're trying to delete a document without an id or locale, this is likely a bug with Strapi. Please open an issue."
          );
          toggleNotification({
            message: formatMessage({
              id: getTranslation("actions.delete.error"),
              defaultMessage: "An error occurred while trying to delete the document locale."
            }),
            type: "danger"
          });
          return;
        }
        const res = await deleteAction({
          documentId,
          model,
          collectionType,
          params: { locale: document.locale }
        });
        if (!("error" in res)) {
          navigate({ pathname: `../${collectionType}/${model}` }, { replace: true });
        }
      }
    }
  };
};
var BulkLocaleAction = ({
  document: baseDocument,
  documentId,
  model,
  collectionType,
  action
}) => {
  var _a;
  const baseLocale = (baseDocument == null ? void 0 : baseDocument.locale) ?? null;
  const [{ query }] = useQueryParams();
  const params = React.useMemo(() => buildValidParams(query), [query]);
  const isOnPublishedTab = query.status === "published";
  const { formatMessage } = useIntl();
  const { hasI18n, canPublish } = useI18n();
  const { toggleNotification } = useNotification();
  const { _unstableFormatAPIError: formatAPIError } = useAPIErrorHandler();
  const [selectedRows, setSelectedRows] = React.useState([]);
  const [isDraftRelationConfirmationOpen, setIsDraftRelationConfirmationOpen] = React.useState(false);
  const { publishMany: publishManyAction, unpublishMany: unpublishManyAction } = useDocumentActions();
  const {
    document,
    meta: documentMeta,
    schema,
    validate
  } = useDocument(
    {
      model,
      collectionType,
      documentId,
      params: {
        locale: baseLocale
      }
    },
    {
      skip: !hasI18n || !baseLocale
    }
  );
  const { data: localesMetadata = [] } = useGetLocalesQuery(hasI18n ? void 0 : skipToken);
  const headers = [
    {
      label: formatMessage({
        id: "global.name",
        defaultMessage: "Name"
      }),
      name: "name"
    },
    {
      label: formatMessage({
        id: getTranslation("CMEditViewBulkLocale.status"),
        defaultMessage: "Status"
      }),
      name: "status"
    },
    {
      label: formatMessage({
        id: getTranslation("CMEditViewBulkLocale.publication-status"),
        defaultMessage: "Publication Status"
      }),
      name: "publication-status"
    }
  ];
  const [rows, validationErrors] = React.useMemo(() => {
    if (!document || !(documentMeta == null ? void 0 : documentMeta.availableLocales)) {
      return [[], {}];
    }
    const rowsFromMeta = documentMeta == null ? void 0 : documentMeta.availableLocales.map((doc) => {
      const { locale, status } = doc;
      return { locale, status };
    });
    rowsFromMeta.unshift({
      locale: document.locale,
      status: document.status
    });
    const allDocuments = [document, ...(documentMeta == null ? void 0 : documentMeta.availableLocales) ?? []];
    const errors = allDocuments.reduce((errs, document2) => {
      if (!document2) {
        return errs;
      }
      const validation = validate(document2);
      if (validation !== null) {
        errs[document2.locale] = validation;
      }
      return errs;
    }, {});
    return [rowsFromMeta, errors];
  }, [document, documentMeta == null ? void 0 : documentMeta.availableLocales, validate]);
  const isBulkPublish = action === "bulk-publish";
  const localesForAction = selectedRows.reduce((acc, selectedRow) => {
    const isValidLocale = (
      // Validation errors are irrelevant if we are trying to unpublish
      !isBulkPublish || !Object.keys(validationErrors).includes(selectedRow.locale)
    );
    const shouldAddLocale = isBulkPublish ? selectedRow.status !== "published" && isValidLocale : selectedRow.status !== "draft" && isValidLocale;
    if (shouldAddLocale) {
      acc.push(selectedRow.locale);
    }
    return acc;
  }, []);
  const enableDraftRelationsCount = false;
  const {
    data: draftRelationsCount = 0,
    isLoading: isDraftRelationsLoading,
    error: isDraftRelationsError
  } = useGetManyDraftRelationCountQuery(
    {
      model,
      documentIds: [documentId],
      locale: localesForAction
    },
    {
      skip: !enableDraftRelationsCount
    }
  );
  React.useEffect(() => {
    if (isDraftRelationsError) {
      toggleNotification({
        type: "danger",
        message: formatAPIError(isDraftRelationsError)
      });
    }
  }, [isDraftRelationsError, toggleNotification, formatAPIError]);
  if (!((_a = schema == null ? void 0 : schema.options) == null ? void 0 : _a.draftAndPublish)) {
    return null;
  }
  if (!hasI18n) {
    return null;
  }
  if (!documentId) {
    return null;
  }
  const publish = async () => {
    await publishManyAction({
      model,
      documentIds: [documentId],
      params: {
        ...params,
        locale: localesForAction
      }
    });
    setSelectedRows([]);
  };
  const unpublish = async () => {
    await unpublishManyAction({
      model,
      documentIds: [documentId],
      params: {
        ...params,
        locale: localesForAction
      }
    });
    setSelectedRows([]);
  };
  const handleAction = async () => {
    if (draftRelationsCount > 0) {
      setIsDraftRelationConfirmationOpen(true);
    } else if (isBulkPublish) {
      await publish();
    } else {
      await unpublish();
    }
  };
  if (isDraftRelationConfirmationOpen) {
    return {
      label: formatMessage({
        id: "app.components.ConfirmDialog.title",
        defaultMessage: "Confirmation"
      }),
      variant: "danger",
      dialog: {
        onCancel: () => {
          setIsDraftRelationConfirmationOpen(false);
        },
        onConfirm: async () => {
          await publish();
          setIsDraftRelationConfirmationOpen(false);
        },
        type: "dialog",
        title: formatMessage({
          id: getTranslation("actions.publish.dialog.title"),
          defaultMessage: "Confirmation"
        }),
        content: (0, import_jsx_runtime.jsxs)(Flex, { direction: "column", alignItems: "center", gap: 2, children: [
          (0, import_jsx_runtime.jsx)(ForwardRef$3, { width: "2.4rem", height: "2.4rem", fill: "danger600" }),
          (0, import_jsx_runtime.jsx)(Typography, { textAlign: "center", children: formatMessage({
            id: getTranslation("CMEditViewBulkLocale.draft-relation-warning"),
            defaultMessage: "Some locales are related to draft entries. Publishing them could leave broken links in your app."
          }) }),
          (0, import_jsx_runtime.jsx)(Typography, { textAlign: "center", children: formatMessage({
            id: getTranslation("CMEditViewBulkLocale.continue-confirmation"),
            defaultMessage: "Are you sure you want to continue?"
          }) })
        ] })
      }
    };
  }
  const hasPermission = selectedRows.map(({ locale }) => locale).every((locale) => canPublish.includes(locale));
  return {
    label: formatMessage({
      id: getTranslation(`CMEditViewBulkLocale.${isBulkPublish ? "publish" : "unpublish"}-title`),
      defaultMessage: `${isBulkPublish ? "Publish" : "Unpublish"} Multiple Locales`
    }),
    variant: isBulkPublish ? "secondary" : "danger",
    icon: isBulkPublish ? (0, import_jsx_runtime.jsx)(ForwardRef$2h, {}) : (0, import_jsx_runtime.jsx)(ForwardRef$3V, {}),
    disabled: isOnPublishedTab || canPublish.length === 0,
    position: ["panel"],
    dialog: {
      type: "modal",
      title: formatMessage({
        id: getTranslation(`CMEditViewBulkLocale.${isBulkPublish ? "publish" : "unpublish"}-title`),
        defaultMessage: `${isBulkPublish ? "Publish" : "Unpublish"} Multiple Locales`
      }),
      content: () => {
        return (0, import_jsx_runtime.jsx)(
          Table.Root,
          {
            headers,
            rows: rows.map((row) => ({
              ...row,
              id: row.locale
            })),
            selectedRows,
            onSelectedRowsChange: (tableSelectedRows) => setSelectedRows(tableSelectedRows),
            children: (0, import_jsx_runtime.jsx)(
              BulkLocaleActionModal,
              {
                validationErrors,
                headers,
                rows,
                localesMetadata,
                action: action ?? "bulk-publish"
              }
            )
          }
        );
      },
      footer: () => (0, import_jsx_runtime.jsx)(Modal.Footer, { justifyContent: "flex-end", children: (0, import_jsx_runtime.jsx)(
        Button,
        {
          loading: isDraftRelationsLoading,
          disabled: !hasPermission || localesForAction.length === 0,
          variant: "default",
          onClick: handleAction,
          children: formatMessage({
            id: isBulkPublish ? "app.utils.publish" : "app.utils.unpublish",
            defaultMessage: isBulkPublish ? "Publish" : "Unpublish"
          })
        }
      ) })
    }
  };
};
var BulkLocalePublishAction = (props) => {
  return BulkLocaleAction({ action: "bulk-publish", ...props });
};
var BulkLocaleUnpublishAction = (props) => {
  return BulkLocaleAction({ action: "bulk-unpublish", ...props });
};
var StyledTrash = dt(ForwardRef$j)`
  path {
    fill: currentColor;
  }
`;
var Emphasis = (chunks) => {
  return (0, import_jsx_runtime.jsx)(Typography, { fontWeight: "semiBold", textColor: "danger500", children: chunks });
};
var DeleteModalAdditionalInfo = () => {
  const { hasI18n } = useI18n();
  const { formatMessage } = useIntl();
  if (!hasI18n) {
    return null;
  }
  return (0, import_jsx_runtime.jsx)(Typography, { textColor: "danger500", children: formatMessage(
    {
      id: getTranslation("Settings.list.actions.deleteAdditionalInfos"),
      defaultMessage: "This will delete the active locale versions <em>(from Internationalization)</em>"
    },
    {
      em: Emphasis
    }
  ) });
};
var PublishModalAdditionalInfo = () => {
  const { hasI18n } = useI18n();
  const { formatMessage } = useIntl();
  if (!hasI18n) {
    return null;
  }
  return (0, import_jsx_runtime.jsx)(Typography, { textColor: "danger500", children: formatMessage(
    {
      id: getTranslation("Settings.list.actions.publishAdditionalInfos"),
      defaultMessage: "This will publish the active locale versions <em>(from Internationalization)</em>"
    },
    {
      em: Emphasis
    }
  ) });
};
var UnpublishModalAdditionalInfo = () => {
  const { hasI18n } = useI18n();
  const { formatMessage } = useIntl();
  if (!hasI18n) {
    return null;
  }
  return (0, import_jsx_runtime.jsx)(Typography, { textColor: "danger500", children: formatMessage(
    {
      id: getTranslation("Settings.list.actions.unpublishAdditionalInfos"),
      defaultMessage: "This will unpublish the active locale versions <em>(from Internationalization)</em>"
    },
    {
      em: Emphasis
    }
  ) });
};
var LocalePicker = () => {
  var _a, _b, _c, _d, _e;
  const { formatMessage } = useIntl();
  const [{ query }, setQuery] = useQueryParams();
  const { hasI18n, canRead, canCreate } = useI18n();
  const { data: locales = [] } = useGetLocalesQuery(void 0, {
    skip: !hasI18n
  });
  const handleChange = React.useCallback(
    (code, replace = false) => {
      setQuery(
        {
          page: 1,
          plugins: { ...query.plugins, i18n: { locale: code } }
        },
        "push",
        replace
      );
    },
    [query.plugins, setQuery]
  );
  React.useEffect(() => {
    var _a2, _b2;
    if (!Array.isArray(locales) || !hasI18n) {
      return;
    }
    const currentDesiredLocale = (_b2 = (_a2 = query.plugins) == null ? void 0 : _a2.i18n) == null ? void 0 : _b2.locale;
    const doesLocaleExist = locales.find((loc) => loc.code === currentDesiredLocale);
    const defaultLocale = locales.find((locale) => locale.isDefault);
    if (!doesLocaleExist && (defaultLocale == null ? void 0 : defaultLocale.code)) {
      handleChange(defaultLocale.code, true);
    }
  }, [hasI18n, handleChange, locales, (_b = (_a = query.plugins) == null ? void 0 : _a.i18n) == null ? void 0 : _b.locale]);
  if (!hasI18n || !Array.isArray(locales) || locales.length === 0) {
    return null;
  }
  const displayedLocales = locales.filter((locale) => {
    return canCreate.includes(locale.code) || canRead.includes(locale.code);
  });
  return (0, import_jsx_runtime.jsx)(
    SingleSelect,
    {
      size: "S",
      "aria-label": formatMessage({
        id: getTranslation("actions.select-locale"),
        defaultMessage: "Select locale"
      }),
      value: ((_d = (_c = query.plugins) == null ? void 0 : _c.i18n) == null ? void 0 : _d.locale) || ((_e = locales.find((locale) => locale.isDefault)) == null ? void 0 : _e.code),
      onChange: handleChange,
      children: displayedLocales.map((locale) => (0, import_jsx_runtime.jsx)(SingleSelectOption, { value: locale.code, children: locale.name }, locale.id))
    }
  );
};
var PERMISSIONS = {
  accessMain: [{ action: "plugin::i18n.locale.read", subject: null }],
  create: [{ action: "plugin::i18n.locale.create", subject: null }],
  delete: [{ action: "plugin::i18n.locale.delete", subject: null }],
  update: [{ action: "plugin::i18n.locale.update", subject: null }],
  read: [{ action: "plugin::i18n.locale.read", subject: null }]
};
var mutateEditViewHook = ({ layout }) => {
  if (!("i18n" in layout.options) || typeof layout.options.i18n === "object" && layout.options.i18n !== null && "localized" in layout.options.i18n && !layout.options.i18n.localized) {
    return { layout };
  }
  const components = Object.entries(layout.components).reduce(
    (acc, [key, componentLayout]) => {
      return {
        ...acc,
        [key]: {
          ...componentLayout,
          layout: componentLayout.layout.map((row) => row.map(addLabelActionToField))
        }
      };
    },
    {}
  );
  return {
    layout: {
      ...layout,
      components,
      layout: layout.layout.map((panel) => panel.map((row) => row.map(addLabelActionToField)))
    }
  };
};
var addLabelActionToField = (field) => {
  const isFieldLocalized = doesFieldHaveI18nPluginOpt(field.attribute.pluginOptions) ? field.attribute.pluginOptions.i18n.localized : true;
  const labelActionProps = {
    title: {
      id: isFieldLocalized ? getTranslation("Field.localized") : getTranslation("Field.not-localized"),
      defaultMessage: isFieldLocalized ? "This value is unique for the selected locale" : "This value is the same across all locales"
    },
    icon: isFieldLocalized ? (0, import_jsx_runtime.jsx)(ForwardRef$3D, {}) : (0, import_jsx_runtime.jsx)(ForwardRef$3B, {})
  };
  return {
    ...field,
    labelAction: (0, import_jsx_runtime.jsx)(LabelAction, { ...labelActionProps })
  };
};
var doesFieldHaveI18nPluginOpt = (pluginOpts) => {
  if (!pluginOpts) {
    return false;
  }
  return "i18n" in pluginOpts && typeof pluginOpts.i18n === "object" && pluginOpts.i18n !== null && "localized" in pluginOpts.i18n;
};
var LabelAction = ({ title, icon }) => {
  const { formatMessage } = useIntl();
  return (0, import_jsx_runtime.jsxs)(Span, { tag: "span", children: [
    (0, import_jsx_runtime.jsx)(VisuallyHidden, { tag: "span", children: formatMessage(title) }),
    React.cloneElement(icon, {
      "aria-hidden": true,
      focusable: false
      // See: https://allyjs.io/tutorials/focusing-in-svg.html#making-svg-elements-focusable
    })
  ] });
};
var Span = dt(Flex)`
  svg {
    width: 12px;
    height: 12px;

    fill: ${({ theme }) => theme.colors.neutral500};

    path {
      fill: ${({ theme }) => theme.colors.neutral500};
    }
  }
`;
var LocaleListCell = ({
  documentId,
  locale: currentLocale,
  collectionType,
  model
}) => {
  const { meta, isLoading } = useDocument({
    documentId,
    collectionType,
    model,
    params: {
      locale: currentLocale
    }
  });
  const { locale: language } = useIntl();
  const { data: locales = [] } = useGetLocalesQuery();
  const formatter = useCollator(language, {
    sensitivity: "base"
  });
  if (!Array.isArray(locales) || isLoading) {
    return null;
  }
  const availableLocales = (meta == null ? void 0 : meta.availableLocales.map((doc) => doc.locale)) ?? [];
  const localesForDocument = locales.reduce((acc, locale) => {
    const createdLocale = [currentLocale, ...availableLocales].find((loc) => {
      return loc === locale.code;
    });
    if (createdLocale) {
      acc.push(locale);
    }
    return acc;
  }, []).map((locale) => {
    if (locale.isDefault) {
      return `${locale.name} (default)`;
    }
    return locale.name;
  }).toSorted((a, b) => formatter.compare(a, b));
  return (0, import_jsx_runtime.jsxs)(Popover.Root, { children: [
    (0, import_jsx_runtime.jsx)(Popover.Trigger, { children: (0, import_jsx_runtime.jsx)(Button, { variant: "ghost", type: "button", onClick: (e) => e.stopPropagation(), children: (0, import_jsx_runtime.jsxs)(Flex, { minWidth: "100%", alignItems: "center", justifyContent: "center", fontWeight: "regular", children: [
      (0, import_jsx_runtime.jsx)(Typography, { textColor: "neutral800", ellipsis: true, marginRight: 2, children: localesForDocument.join(", ") }),
      (0, import_jsx_runtime.jsx)(Flex, { children: (0, import_jsx_runtime.jsx)(ForwardRef$4D, { width: "1.2rem", height: "1.2rem" }) })
    ] }) }) }),
    (0, import_jsx_runtime.jsx)(Popover.Content, { sideOffset: 16, children: (0, import_jsx_runtime.jsx)("ul", { children: localesForDocument.map((name) => (0, import_jsx_runtime.jsx)(Box, { padding: 3, tag: "li", children: (0, import_jsx_runtime.jsx)(Typography, { children: name }) }, name)) }) })
  ] });
};
var addColumnToTableHook = ({ displayedHeaders, layout }) => {
  const { options } = layout;
  const isFieldLocalized = doesPluginOptionsHaveI18nLocalized(options) ? options.i18n.localized : false;
  if (!isFieldLocalized) {
    return { displayedHeaders, layout };
  }
  return {
    displayedHeaders: [
      ...displayedHeaders,
      {
        attribute: { type: "string" },
        label: {
          id: getTranslation("list-view.table.header.label"),
          defaultMessage: "Available in"
        },
        searchable: false,
        sortable: false,
        name: "locales",
        // @ts-expect-error â€“ ID is seen as number | string; this will change when we move the type over.
        cellFormatter: (props, _header, meta) => (0, import_jsx_runtime.jsx)(LocaleListCell, { ...props, ...meta })
      }
    ],
    layout
  };
};
var addLocaleToReleasesHook = ({ displayedHeaders = [] }) => {
  return {
    displayedHeaders: [
      ...displayedHeaders,
      {
        label: {
          id: "content-releases.page.ReleaseDetails.table.header.label.locale",
          defaultMessage: "locale"
        },
        name: "locale"
      }
    ],
    hasI18nEnabled: true
  };
};
var extendCTBAttributeInitialDataMiddleware = () => {
  return ({ getState }) => (next) => (action) => {
    const enhanceAction = () => {
      try {
        const store = getState();
        const hasi18nEnabled = (0, import_get.default)(
          store,
          [
            "content-type-builder_dataManagerProvider",
            "modifiedData",
            "contentType",
            "schema",
            "pluginOptions",
            "i18n",
            "localized"
          ],
          false
        );
        if (hasi18nEnabled) {
          const pluginOptions = action.options ? { ...action.options.pluginOptions, i18n: { localized: true } } : { i18n: { localized: true } };
          return next({
            ...action,
            options: {
              pluginOptions
            }
          });
        }
        return next(action);
      } catch (err) {
        return next(action);
      }
    };
    if (action.type === "ContentTypeBuilder/FormModal/SET_ATTRIBUTE_DATA_SCHEMA" && action.forTarget === "contentType" && !["relation", "component"].includes(action.attributeType) && !action.isEditing) {
      return enhanceAction();
    }
    if (action.type === "ContentTypeBuilder/FormModal/SET_CUSTOM_FIELD_DATA_SCHEMA" && action.forTarget === "contentType" && !action.isEditing) {
      return enhanceAction();
    }
    if ((action.type === "ContentTypeBuilder/FormModal/RESET_PROPS_AND_SET_FORM_FOR_ADDING_AN_EXISTING_COMPO" || action.type === "ContentTypeBuilder/FormModal/RESET_PROPS_AND_SAVE_CURRENT_DATA") && action.forTarget === "contentType") {
      return enhanceAction();
    }
    return next(action);
  };
};
var extendCTBInitialDataMiddleware = () => {
  return () => (next) => (action) => {
    var _a, _b;
    if (action.type === "ContentTypeBuilder/FormModal/SET_DATA_TO_EDIT" && action.modalType === "contentType") {
      const i18n = { localized: false };
      const pluginOptions = action.data.pluginOptions ? { ...action.data.pluginOptions, i18n } : { i18n };
      const data = { ...action.data, pluginOptions };
      if (action.actionType === "create") {
        return next({ ...action, data });
      }
      if (!((_b = (_a = action.data.pluginOptions) == null ? void 0 : _a.i18n) == null ? void 0 : _b.localized)) {
        return next({ ...action, data });
      }
    }
    return next(action);
  };
};
var localeMiddleware = (ctx) => (next) => (permissions) => {
  const match = matchPath("/content-manager/:collectionType/:model?/:id", ctx.pathname);
  if (!match) {
    return next(permissions);
  }
  const search = qs.parse(ctx.search);
  if (typeof search !== "object") {
    return next(permissions);
  }
  if (!("plugins" in search && typeof search.plugins === "object")) {
    return next(permissions);
  }
  if (!("i18n" in search.plugins && typeof search.plugins.i18n === "object" && !Array.isArray(search.plugins.i18n))) {
    return next(permissions);
  }
  const { locale } = search.plugins.i18n;
  if (typeof locale !== "string") {
    return next(permissions);
  }
  const revisedPermissions = permissions.filter(
    (permission) => {
      var _a;
      return !((_a = permission.properties) == null ? void 0 : _a.locales) || permission.properties.locales.includes(locale);
    }
  );
  return next(revisedPermissions);
};
var prefixPluginTranslations = (trad, pluginId2) => {
  if (!pluginId2) {
    throw new TypeError("pluginId can't be empty");
  }
  return Object.keys(trad).reduce((acc, current) => {
    acc[`${pluginId2}.${current}`] = trad[current];
    return acc;
  }, {});
};
var mutateCTBContentTypeSchema = (nextSchema, prevSchema) => {
  var _a, _b;
  if (!doesPluginOptionsHaveI18nLocalized(nextSchema.pluginOptions)) {
    return nextSchema;
  }
  const isNextSchemaLocalized = nextSchema.pluginOptions.i18n.localized;
  const isPrevSchemaLocalized = doesPluginOptionsHaveI18nLocalized(
    (_a = prevSchema == null ? void 0 : prevSchema.schema) == null ? void 0 : _a.pluginOptions
  ) ? (_b = prevSchema == null ? void 0 : prevSchema.schema) == null ? void 0 : _b.pluginOptions.i18n.localized : false;
  if (isNextSchemaLocalized && isPrevSchemaLocalized) {
    return nextSchema;
  }
  if (isNextSchemaLocalized) {
    const attributes = addLocalisationToFields(nextSchema.attributes);
    return { ...nextSchema, attributes };
  }
  if (!isNextSchemaLocalized) {
    const pluginOptions = (0, import_omit.default)(nextSchema.pluginOptions, "i18n");
    const attributes = disableAttributesLocalisation(nextSchema.attributes);
    return { ...nextSchema, pluginOptions, attributes };
  }
  return nextSchema;
};
var addLocalisationToFields = (attributes) => Object.keys(attributes).reduce((acc, current) => {
  const currentAttribute = attributes[current];
  if (LOCALIZED_FIELDS.includes(currentAttribute.type)) {
    const i18n = { localized: true };
    const pluginOptions = currentAttribute.pluginOptions ? { ...currentAttribute.pluginOptions, i18n } : { i18n };
    acc[current] = { ...currentAttribute, pluginOptions };
    return acc;
  }
  acc[current] = currentAttribute;
  return acc;
}, {});
var disableAttributesLocalisation = (attributes) => Object.keys(attributes).reduce((acc, current) => {
  acc[current] = (0, import_omit.default)(attributes[current], "pluginOptions.i18n");
  return acc;
}, {});
var index = {
  register(app) {
    app.addMiddlewares([extendCTBAttributeInitialDataMiddleware, extendCTBInitialDataMiddleware]);
    app.addMiddlewares([() => i18nApi.middleware]);
    app.addReducers({
      [i18nApi.reducerPath]: i18nApi.reducer
    });
    app.addRBACMiddleware([localeMiddleware]);
    app.registerPlugin({
      id: pluginId,
      name: pluginId
    });
  },
  bootstrap(app) {
    app.registerHook("Admin/CM/pages/ListView/inject-column-in-table", addColumnToTableHook);
    app.registerHook("Admin/CM/pages/EditView/mutate-edit-view-layout", mutateEditViewHook);
    app.registerHook(
      "ContentReleases/pages/ReleaseDetails/add-locale-in-releases",
      addLocaleToReleasesHook
    );
    app.addSettingsLink("global", {
      intlLabel: {
        id: getTranslation("plugin.name"),
        defaultMessage: "Internationalization"
      },
      id: "internationalization",
      to: "internationalization",
      Component: () => import("./SettingsPage-BjxjwEOb-3KU3FDHE.js").then((mod) => ({ default: mod.ProtectedSettingsPage })),
      permissions: PERMISSIONS.accessMain
    });
    const contentManager = app.getPlugin("content-manager");
    contentManager.apis.addDocumentHeaderAction([LocalePickerAction, FillFromAnotherLocaleAction]);
    contentManager.apis.addDocumentAction((actions) => {
      const indexOfDeleteAction = actions.findIndex((action) => action.type === "delete");
      actions.splice(indexOfDeleteAction, 0, DeleteLocaleAction);
      return actions;
    });
    contentManager.apis.addDocumentAction((actions) => {
      actions.splice(2, 0, BulkLocalePublishAction);
      actions.splice(5, 0, BulkLocaleUnpublishAction);
      return actions;
    });
    contentManager.injectComponent("listView", "actions", {
      name: "i18n-locale-filter",
      Component: LocalePicker
    });
    contentManager.injectComponent("listView", "publishModalAdditionalInfos", {
      name: "i18n-publish-bullets-in-modal",
      Component: PublishModalAdditionalInfo
    });
    contentManager.injectComponent("listView", "unpublishModalAdditionalInfos", {
      name: "i18n-unpublish-bullets-in-modal",
      Component: UnpublishModalAdditionalInfo
    });
    contentManager.injectComponent("listView", "deleteModalAdditionalInfos", {
      name: "i18n-delete-bullets-in-modal",
      Component: DeleteModalAdditionalInfo
    });
    const ctbPlugin = app.getPlugin("content-type-builder");
    if (ctbPlugin) {
      const ctbFormsAPI = ctbPlugin.apis.forms;
      ctbFormsAPI.addContentTypeSchemaMutation(mutateCTBContentTypeSchema);
      ctbFormsAPI.components.add({ id: "checkboxConfirmation", component: CheckboxConfirmation });
      ctbFormsAPI.extendContentType({
        validator: () => ({
          i18n: create2().shape({
            localized: create()
          })
        }),
        form: {
          advanced() {
            return [
              {
                name: "pluginOptions.i18n.localized",
                description: {
                  id: getTranslation("plugin.schema.i18n.localized.description-content-type"),
                  defaultMessage: "Allows translating an entry into different languages"
                },
                type: "checkboxConfirmation",
                intlLabel: {
                  id: getTranslation("plugin.schema.i18n.localized.label-content-type"),
                  defaultMessage: "Localization"
                }
              }
            ];
          }
        }
      });
      ctbFormsAPI.extendFields(LOCALIZED_FIELDS, {
        validator: (args) => ({
          i18n: create2().shape({
            localized: create().test({
              name: "ensure-unique-localization",
              message: getTranslation("plugin.schema.i18n.ensure-unique-localization"),
              test(value) {
                if (value === void 0 || value) {
                  return true;
                }
                const unique = (0, import_get.default)(args, ["3", "modifiedData", "unique"], null);
                if (unique && !value) {
                  return false;
                }
                return true;
              }
            })
          })
        }),
        form: {
          advanced({ contentTypeSchema, forTarget, type, step }) {
            if (forTarget !== "contentType") {
              return [];
            }
            const hasI18nEnabled = (0, import_get.default)(
              contentTypeSchema,
              ["schema", "pluginOptions", "i18n", "localized"],
              false
            );
            if (!hasI18nEnabled) {
              return [];
            }
            if (type === "component" && step === "1") {
              return [];
            }
            return [
              {
                name: "pluginOptions.i18n.localized",
                description: {
                  id: getTranslation("plugin.schema.i18n.localized.description-field"),
                  defaultMessage: "The field can have different values in each locale"
                },
                type: "checkbox",
                intlLabel: {
                  id: getTranslation("plugin.schema.i18n.localized.label-field"),
                  defaultMessage: "Enable localization for this field"
                }
              }
            ];
          }
        }
      });
    }
  },
  async registerTrads({ locales }) {
    const importedTrads = await Promise.all(
      locales.map((locale) => {
        return __variableDynamicImportRuntimeHelper(Object.assign({ "./translations/de.json": () => import("./de-9eCAqqrB-DIKNJRVS.js"), "./translations/dk.json": () => import("./dk-2qBjxt-P-4UCWN4LW.js"), "./translations/en.json": () => import("./en-2xztdZE1-NCRJAK53.js"), "./translations/es.json": () => import("./es-DlmMVaBG-LME6H2BI.js"), "./translations/fr.json": () => import("./fr-3S6ke71d-G6MKIIOM.js"), "./translations/ko.json": () => import("./ko-qTjQ8IMw-TJAF4GJ5.js"), "./translations/pl.json": () => import("./pl-B67TSHqT-Y27R7J4E.js"), "./translations/ru.json": () => import("./ru-hagMa57T-SAU2A6I4.js"), "./translations/tr.json": () => import("./tr-Dw_jmkG--U64YYHME.js"), "./translations/zh-Hans.json": () => import("./zh-Hans-Dyc-aR-h-BRU2ZDHC.js"), "./translations/zh.json": () => import("./zh-57YM4amO-DSRSNHHU.js") }), `./translations/${locale}.json`).then(({ default: data }) => {
          return {
            data: prefixPluginTranslations(data, pluginId),
            locale
          };
        }).catch(() => {
          return {
            data: {},
            locale
          };
        });
      })
    );
    return Promise.resolve(importedTrads);
  }
};

export {
  getTranslation,
  useCreateLocaleMutation,
  useDeleteLocaleMutation,
  useGetLocalesQuery,
  useGetDefaultLocalesQuery,
  useUpdateLocaleMutation,
  PERMISSIONS,
  index
};
//# sourceMappingURL=chunk-NWSAEHAD.js.map
